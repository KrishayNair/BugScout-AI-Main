"use strict";(()=>{var e={};e.id=233,e.ids=[233],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27601:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>d,patchFetch:()=>g,requestAsyncStorage:()=>u,routeModule:()=>p,serverHooks:()=>l,staticGenerationAsyncStorage:()=>c});var n={};s.r(n),s.d(n,{POST:()=>a});var o=s(73278),r=s(45002),i=s(54877);async function a(e){let t=process.env.OPENAI_API_KEY;if(!t)return Response.json({insights:[],message:"OPENAI_API_KEY is not set"},{status:200});try{let{recordingsCount:s=0,uniqueUsers:n=0,pageviewsTotal:o=0,recentEventTypes:r=[],recordingsWithErrors:i=0,topRecordingDuration:a}=await e.json(),p=`
Dashboard metrics (last 7 days):
- Session recordings: ${s}
- Unique users (persons): ${n}
- Total pageviews: ${o}
- Recordings with console errors: ${i}
- Top event types: ${Array.from(new Set(r)).slice(0,10).join(", ")||"none"}
${null!=a?`- Longest recording: ${a}s`:""}
`.trim(),u=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:'You are an analytics assistant for a product dashboard. Given metrics from PostHog (session recordings, events, pageviews), respond with exactly 3 to 5 short, actionable insight bullets. Be concise (one line per bullet). Focus on what matters: engagement, errors, trends, and suggested next steps. Output valid JSON only: { "insights": ["bullet 1", "bullet 2", ...] }. No markdown, no code block wrapper.'},{role:"user",content:p}],response_format:{type:"json_object"},max_completion_tokens:400})});if(!u.ok)return await u.text(),Response.json({insights:[],error:`OpenAI API error: ${u.status}`},{status:200});let c=await u.json(),l=c.choices?.[0]?.message?.content;if(!l)return Response.json({insights:[]},{status:200});let d=[];try{let e=JSON.parse(l);d=Array.isArray(e.insights)?e.insights:[]}catch{d=l.split(/\n/).map(e=>e.replace(/^[-*]\s*/,"").trim()).filter(Boolean).slice(0,5)}return Response.json({insights:d})}catch{return Response.json({insights:[]},{status:200})}}let p=new o.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/insights/route",pathname:"/api/insights",filename:"route",bundlePath:"app/api/insights/route"},resolvedPagePath:"C:\\Users\\RISHAY\\Downloads\\bugScout Frontend\\app\\api\\insights\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:u,staticGenerationAsyncStorage:c,serverHooks:l}=p,d="/api/insights/route";function g(){return(0,i.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:c})}},73278:(e,t,s)=>{e.exports=s(30517)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[379],()=>s(27601));module.exports=n})();
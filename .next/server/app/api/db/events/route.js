(()=>{var e={};e.id=214,e.ids=[214],e.modules={56572:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=56572,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{"use strict";e.exports=require("sharp")},87561:e=>{"use strict";e.exports=require("node:fs")},49411:e=>{"use strict";e.exports=require("node:path")},97742:e=>{"use strict";e.exports=require("node:process")},41041:e=>{"use strict";e.exports=require("node:url")},46643:(e,t,n)=>{"use strict";n.r(t),n.d(t,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>_,staticGenerationAsyncStorage:()=>v});var r={};n.r(r),n.d(r,{GET:()=>g,POST:()=>p});var o=n(73278),i=n(45002),s=n(54877),a=n(68420),d=n(27382),l=n(10318),u=n(29785),c=n(95013);async function g(e){if(!process.env.DATABASE_URL)return Response.json({events:[]},{status:200});try{let{searchParams:t}=new URL(e.url),n=Math.min(Number(t.get("limit"))||50,200),r=Math.max(0,Number(t.get("offset"))||0),o=t.get("event"),i=t.get("distinct_id"),s=[];o&&s.push((0,u.eq)(d.posthogEvents.eventName,o)),i&&s.push((0,u.eq)(d.posthogEvents.distinctId,i));let l=s.length>0?(0,u.xD)(...s):void 0,g=await a.db.select().from(d.posthogEvents).where(l).orderBy((0,c.C)(d.posthogEvents.timestamp)).limit(n).offset(r);return Response.json({events:g})}catch(e){return console.error("GET /api/db/events error:",e),Response.json({events:[]},{status:200})}}async function p(e){if(!process.env.DATABASE_URL)return Response.json({ok:!1},{status:503});try{let t=await e.json(),n=Array.isArray(t.events)?t.events:[];if(0===n.length)return Response.json({ok:!0,inserted:0});let r=n.map(e=>(function(e){let t=e.id??crypto.randomUUID(),n=function(e){if(null==e)return null;if("object"==typeof e)return e;try{return JSON.parse(e)}catch{return null}}(e.properties),r=function(e,t){let n={};if(e){let t=e.$el_tag_name??e.tag_name,r=e.$el_text??e.el_text??e.text;t&&(n.tag=t),r&&(n.text=r)}if(t&&Array.isArray(t)&&t.length>0){let e=t[0];e&&(!n.tag&&e.tag_name&&(n.tag=String(e.tag_name)),!n.text&&e.text&&(n.text=String(e.text)))}return n}(n,e.elements??null),o=function(e){if(!e)return null;let t=e.$current_url??e.current_url??e.$pathname??e.pathname;return"string"==typeof t?t:null}(n),i=n?.$session_id!=null?String(n.$session_id):null;return{posthogEventId:t,eventName:e.event??"$unknown",distinctId:null!=e.distinct_id?String(e.distinct_id):null,timestamp:e.timestamp?new Date(e.timestamp):new Date,url:o,elementTag:r.tag??null,elementText:r.text??null,sessionId:i,properties:n}})(e));return await a.db.insert(d.posthogEvents).values(r).onConflictDoNothing({target:d.posthogEvents.posthogEventId}),l.c.syncPosthogEvents(r).catch(()=>{}),Response.json({ok:!0,inserted:r.length})}catch(e){return console.error("POST /api/db/events error:",e),Response.json({ok:!1},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/db/events/route",pathname:"/api/db/events",filename:"route",bundlePath:"app/api/db/events/route"},resolvedPagePath:"C:\\Users\\RISHAY\\Downloads\\bugScout Frontend\\app\\api\\db\\events\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:v,serverHooks:_}=m,h="/api/db/events/route";function y(){return(0,s.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:v})}},68420:(e,t,n)=>{"use strict";n.d(t,{db:()=>a});var r=n(40546),o=n(92512),i=n(27382);let s=(0,r.qn)(process.env.DATABASE_URL),a=(0,o.tS)(s,{schema:i})},27382:(e,t,n)=>{"use strict";n.r(t),n.d(t,{issueRevisions:()=>m,issues:()=>p,logs:()=>f,monitoring:()=>g,posthogEvents:()=>v});var r=n(61951),o=n(59397),i=n(39411),s=n(84006),a=n(70380),d=n(83204),l=n(10950),u=n(21305),c=n(67691);let g=(0,r.af)("monitoring",{id:(0,o.Vj)("id").primaryKey().defaultRandom(),recordingId:(0,i.fL)("recording_id").notNull(),distinctId:(0,i.fL)("distinct_id"),recordingDuration:(0,s._L)("recording_duration"),startTime:(0,a.AB)("start_time",{withTimezone:!0}),clickCount:(0,s._L)("click_count"),consoleErrorCount:(0,s._L)("console_error_count"),rageClickCount:(0,s._L)("rage_click_count"),deadClickCount:(0,s._L)("dead_click_count"),startUrl:(0,i.fL)("start_url"),payload:(0,d.JB)("payload"),createdAt:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()},e=>[(0,l.o9)("monitoring_recording_id_idx").on(e.recordingId)]),p=(0,r.af)("issues",{id:(0,o.Vj)("id").primaryKey().defaultRandom(),recordingId:(0,i.fL)("recording_id").notNull().unique(),posthogCategoryId:(0,i.fL)("posthog_category_id").notNull(),posthogIssueTypeId:(0,i.fL)("posthog_issue_type_id").notNull(),title:(0,i.fL)("title").notNull(),description:(0,i.fL)("description").notNull(),severity:(0,i.fL)("severity").notNull(),codeLocation:(0,i.fL)("code_location").notNull(),codeSnippetHint:(0,i.fL)("code_snippet_hint"),startUrl:(0,i.fL)("start_url"),suggestedFix:(0,i.fL)("suggested_fix"),status:(0,i.fL)("status").notNull().default("Unresolved"),approved:(0,u.O7)("approved").notNull().default(!1),approvedRating:(0,s._L)("approved_rating"),approvedAt:(0,a.AB)("approved_at",{withTimezone:!0}),createdAt:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,a.AB)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),m=(0,r.af)("issue_revisions",{id:(0,o.Vj)("id").primaryKey().defaultRandom(),issueId:(0,o.Vj)("issue_id").notNull().references(()=>p.id,{onDelete:"cascade"}),instruction:(0,i.fL)("instruction").notNull(),suggestedFixAfter:(0,i.fL)("suggested_fix_after"),createdAt:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),f=(0,r.af)("logs",{id:(0,o.Vj)("id").primaryKey().defaultRandom(),issueId:(0,o.Vj)("issue_id").references(()=>p.id),recordingId:(0,i.fL)("recording_id").notNull(),title:(0,i.fL)("title").notNull(),description:(0,i.fL)("description").notNull(),severity:(0,i.fL)("severity").notNull(),suggestedFix:(0,i.fL)("suggested_fix").notNull(),developerRating:(0,s._L)("developer_rating"),agentConfidenceScore:(0,c.gH)("agent_confidence_score",{precision:3,scale:2}),createdAt:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),v=(0,r.af)("posthog_events",{id:(0,o.Vj)("id").primaryKey().defaultRandom(),posthogEventId:(0,i.fL)("posthog_event_id").notNull(),eventName:(0,i.fL)("event_name").notNull(),distinctId:(0,i.fL)("distinct_id"),timestamp:(0,a.AB)("timestamp",{withTimezone:!0}).notNull(),url:(0,i.fL)("url"),elementTag:(0,i.fL)("element_tag"),elementText:(0,i.fL)("element_text"),sessionId:(0,i.fL)("session_id"),properties:(0,d.JB)("properties"),createdAt:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()},e=>[(0,l.o9)("posthog_events_posthog_event_id_idx").on(e.posthogEventId)])},10318:(e,t,n)=>{"use strict";n.d(t,{c:()=>l});var r=n(74266);async function o(e){let t=process.env.OPENAI_API_KEY;if(!t)throw Error("OPENAI_API_KEY is required for Chroma embeddings");let n=await fetch("https://api.openai.com/v1/embeddings",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"text-embedding-3-small",input:e})});if(!n.ok){let e=await n.text();throw Error(`OpenAI embeddings failed: ${n.status} ${e}`)}return(await n.json()).data.map(e=>e.embedding)}let i=null;async function s(e,t){if(0===t.length)return;let n=function(){if(!process.env.CHROMA_API_KEY)return null;if(i)return i;try{return i=new r.NF({apiKey:process.env.CHROMA_API_KEY,tenant:process.env.CHROMA_TENANT??"38d2507b-966b-47d3-b7a5-dd1385383481",database:process.env.CHROMA_DATABASE??"bugScoutAI-main"})}catch{return null}}();if(!n)return;let s=process.env.OPENAI_API_KEY?{async generate(e){if(0===e.length)return[];let t=[];for(let n=0;n<e.length;n+=100){let r=e.slice(n,n+100);t.push(...await o(r))}return t},async generateQueryEmbeddings(e){return this.generate(e)}}:null;if(!s){console.warn("[Chroma] OPENAI_API_KEY not set; skipping sync. Set it in .env.local for Chroma embeddings.");return}try{let r=await n.getOrCreateCollection({name:e,embeddingFunction:s}),o=t.map(e=>e.id),i=t.map(e=>e.document),a=t.map(e=>(function(e){let t={};for(let[n,r]of Object.entries(e))null!=r&&("string"==typeof r||"number"==typeof r||"boolean"==typeof r?t[n]=r:t[n]=String(r));return t})({...e.metadata,source:"bugscout"}));await r.add({ids:o,documents:i,metadatas:a})}catch(t){console.error(`[Chroma] addToChroma(${e}) error:`,t)}}var a=n(68420),d=n(27382);let l={async syncMonitoring(e){if(0===e.length)return;let t=e.map(e=>({id:e.recordingId,document:JSON.stringify({recordingId:e.recordingId,distinctId:e.distinctId,recordingDuration:e.recordingDuration,startTime:e.startTime,clickCount:e.clickCount,consoleErrorCount:e.consoleErrorCount,rageClickCount:e.rageClickCount,deadClickCount:e.deadClickCount,startUrl:e.startUrl}),metadata:{recordingId:e.recordingId,table:"monitoring"}}));await s("monitoring",t)},async syncIssues(e){if(0===e.length)return;let t=e.map(e=>({id:e.id??e.recordingId,document:JSON.stringify({recordingId:e.recordingId,title:e.title,description:e.description,severity:e.severity,codeLocation:e.codeLocation,suggestedFix:e.suggestedFix,status:e.status}),metadata:{recordingId:e.recordingId,table:"issues",severity:e.severity,title:e.title}}));await s("issues",t)},async syncLogs(e){if(0===e.length)return;let t=e.map((e,t)=>({id:e.id?`${e.recordingId}-${e.id}`:`${e.recordingId}-${Date.now()}-${t}`,document:JSON.stringify({recordingId:e.recordingId,title:e.title,description:e.description,severity:e.severity,suggestedFix:e.suggestedFix,developerRating:e.developerRating,agentConfidenceScore:e.agentConfidenceScore}),metadata:{recordingId:e.recordingId,table:"logs",severity:e.severity,title:e.title}}));await s("logs",t)},async syncPosthogEvents(e){if(0===e.length)return;let t=e.map(e=>({id:e.posthogEventId,document:JSON.stringify({eventName:e.eventName,url:e.url,elementTag:e.elementTag,elementText:e.elementText,timestamp:e.timestamp,distinctId:e.distinctId}),metadata:{posthogEventId:e.posthogEventId,table:"posthog_events",eventName:e.eventName}}));await s("posthog_events",t)},async syncAll(){let e=await a.db.select().from(d.monitoring);for(let t=0;t<e.length;t+=100)await l.syncMonitoring(e.slice(t,t+100));let t=await a.db.select().from(d.issues);for(let e=0;e<t.length;e+=100)await l.syncIssues(t.slice(e,e+100));let n=await a.db.select().from(d.logs);for(let e=0;e<n.length;e+=100)await l.syncLogs(n.slice(e,e+100));let r=await a.db.select().from(d.posthogEvents);for(let e=0;e<r.length;e+=100)await l.syncPosthogEvents(r.slice(e,e+100));return{monitoring:e.length,issues:t.length,logs:n.length,posthog_events:r.length}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[379,321,266],()=>n(46643));module.exports=r})();
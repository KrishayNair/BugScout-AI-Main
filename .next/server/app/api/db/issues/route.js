(()=>{var e={};e.id=488,e.ids=[488],e.modules={56572:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=56572,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{"use strict";e.exports=require("sharp")},87561:e=>{"use strict";e.exports=require("node:fs")},49411:e=>{"use strict";e.exports=require("node:path")},97742:e=>{"use strict";e.exports=require("node:process")},41041:e=>{"use strict";e.exports=require("node:url")},44453:(e,t,s)=>{"use strict";s.r(t),s.d(t,{originalPathname:()=>_,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var o={};s.r(o),s.d(o,{GET:()=>c,POST:()=>g});var r=s(73278),i=s(45002),n=s(54877),d=s(68420),a=s(27382),l=s(10318),u=s(29785);async function c(e){if(!process.env.DATABASE_URL)return Response.json({issues:[]},{status:200});try{let{searchParams:t}=new URL(e.url),s=t.get("recordingId"),o=s?await d.db.select().from(a.issues).where((0,u.eq)(a.issues.recordingId,s)):await d.db.select().from(a.issues);return Response.json({issues:o})}catch(e){return console.error("GET /api/db/issues error:",e),Response.json({issues:[]},{status:200})}}async function g(e){if(!process.env.DATABASE_URL)return Response.json({ok:!1},{status:503});try{let t=await e.json(),s=Array.isArray(t.issues)?t.issues:[];for(let e of s)await d.db.insert(a.issues).values({recordingId:e.recordingId,posthogCategoryId:e.posthogCategoryId,posthogIssueTypeId:e.posthogIssueTypeId,title:e.title,description:e.description,severity:e.severity,codeLocation:e.codeLocation,codeSnippetHint:e.codeSnippetHint??null,startUrl:e.startUrl??null,suggestedFix:e.suggestedFix??null}).onConflictDoUpdate({target:a.issues.recordingId,set:{posthogCategoryId:e.posthogCategoryId,posthogIssueTypeId:e.posthogIssueTypeId,title:e.title,description:e.description,severity:e.severity,codeLocation:e.codeLocation,codeSnippetHint:e.codeSnippetHint??null,startUrl:e.startUrl??null,suggestedFix:e.suggestedFix??null,updatedAt:new Date}});return await l.c.syncIssues(s).catch(e=>{console.error("[POST /api/db/issues] Chroma sync failed:",e)}),Response.json({ok:!0})}catch(e){return console.error("POST /api/db/issues error:",e),Response.json({ok:!1},{status:500})}}let p=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/db/issues/route",pathname:"/api/db/issues",filename:"route",bundlePath:"app/api/db/issues/route"},resolvedPagePath:"C:\\Users\\RISHAY\\Downloads\\bugScout Frontend\\app\\api\\db\\issues\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:h}=p,_="/api/db/issues/route";function y(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},68420:(e,t,s)=>{"use strict";s.d(t,{db:()=>d});var o=s(40546),r=s(92512),i=s(27382);let n=(0,o.qn)(process.env.DATABASE_URL),d=(0,r.tS)(n,{schema:i})},27382:(e,t,s)=>{"use strict";s.r(t),s.d(t,{issueRevisions:()=>f,issues:()=>p,logs:()=>m,monitoring:()=>g,posthogEvents:()=>h});var o=s(61951),r=s(59397),i=s(39411),n=s(84006),d=s(70380),a=s(83204),l=s(10950),u=s(21305),c=s(67691);let g=(0,o.af)("monitoring",{id:(0,r.Vj)("id").primaryKey().defaultRandom(),recordingId:(0,i.fL)("recording_id").notNull(),distinctId:(0,i.fL)("distinct_id"),recordingDuration:(0,n._L)("recording_duration"),startTime:(0,d.AB)("start_time",{withTimezone:!0}),clickCount:(0,n._L)("click_count"),consoleErrorCount:(0,n._L)("console_error_count"),rageClickCount:(0,n._L)("rage_click_count"),deadClickCount:(0,n._L)("dead_click_count"),startUrl:(0,i.fL)("start_url"),payload:(0,a.JB)("payload"),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()},e=>[(0,l.o9)("monitoring_recording_id_idx").on(e.recordingId)]),p=(0,o.af)("issues",{id:(0,r.Vj)("id").primaryKey().defaultRandom(),recordingId:(0,i.fL)("recording_id").notNull().unique(),posthogCategoryId:(0,i.fL)("posthog_category_id").notNull(),posthogIssueTypeId:(0,i.fL)("posthog_issue_type_id").notNull(),title:(0,i.fL)("title").notNull(),description:(0,i.fL)("description").notNull(),severity:(0,i.fL)("severity").notNull(),codeLocation:(0,i.fL)("code_location").notNull(),codeSnippetHint:(0,i.fL)("code_snippet_hint"),startUrl:(0,i.fL)("start_url"),suggestedFix:(0,i.fL)("suggested_fix"),status:(0,i.fL)("status").notNull().default("Unresolved"),approved:(0,u.O7)("approved").notNull().default(!1),approvedRating:(0,n._L)("approved_rating"),approvedAt:(0,d.AB)("approved_at",{withTimezone:!0}),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),f=(0,o.af)("issue_revisions",{id:(0,r.Vj)("id").primaryKey().defaultRandom(),issueId:(0,r.Vj)("issue_id").notNull().references(()=>p.id,{onDelete:"cascade"}),instruction:(0,i.fL)("instruction").notNull(),suggestedFixAfter:(0,i.fL)("suggested_fix_after"),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),m=(0,o.af)("logs",{id:(0,r.Vj)("id").primaryKey().defaultRandom(),issueId:(0,r.Vj)("issue_id").references(()=>p.id),recordingId:(0,i.fL)("recording_id").notNull(),title:(0,i.fL)("title").notNull(),description:(0,i.fL)("description").notNull(),severity:(0,i.fL)("severity").notNull(),suggestedFix:(0,i.fL)("suggested_fix").notNull(),developerRating:(0,n._L)("developer_rating"),agentConfidenceScore:(0,c.gH)("agent_confidence_score",{precision:3,scale:2}),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),h=(0,o.af)("posthog_events",{id:(0,r.Vj)("id").primaryKey().defaultRandom(),posthogEventId:(0,i.fL)("posthog_event_id").notNull(),eventName:(0,i.fL)("event_name").notNull(),distinctId:(0,i.fL)("distinct_id"),timestamp:(0,d.AB)("timestamp",{withTimezone:!0}).notNull(),url:(0,i.fL)("url"),elementTag:(0,i.fL)("element_tag"),elementText:(0,i.fL)("element_text"),sessionId:(0,i.fL)("session_id"),properties:(0,a.JB)("properties"),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()},e=>[(0,l.o9)("posthog_events_posthog_event_id_idx").on(e.posthogEventId)])},10318:(e,t,s)=>{"use strict";s.d(t,{c:()=>l});var o=s(74266);async function r(e){let t=process.env.OPENAI_API_KEY;if(!t)throw Error("OPENAI_API_KEY is required for Chroma embeddings");let s=await fetch("https://api.openai.com/v1/embeddings",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"text-embedding-3-small",input:e})});if(!s.ok){let e=await s.text();throw Error(`OpenAI embeddings failed: ${s.status} ${e}`)}return(await s.json()).data.map(e=>e.embedding)}let i=null;async function n(e,t){if(0===t.length)return;let s=function(){if(!process.env.CHROMA_API_KEY)return null;if(i)return i;try{return i=new o.NF({apiKey:process.env.CHROMA_API_KEY,tenant:process.env.CHROMA_TENANT??"38d2507b-966b-47d3-b7a5-dd1385383481",database:process.env.CHROMA_DATABASE??"bugScoutAI-main"})}catch{return null}}();if(!s)return;let n=process.env.OPENAI_API_KEY?{async generate(e){if(0===e.length)return[];let t=[];for(let s=0;s<e.length;s+=100){let o=e.slice(s,s+100);t.push(...await r(o))}return t},async generateQueryEmbeddings(e){return this.generate(e)}}:null;if(!n){console.warn("[Chroma] OPENAI_API_KEY not set; skipping sync. Set it in .env.local for Chroma embeddings.");return}try{let o=await s.getOrCreateCollection({name:e,embeddingFunction:n}),r=t.map(e=>e.id),i=t.map(e=>e.document),d=t.map(e=>(function(e){let t={};for(let[s,o]of Object.entries(e))null!=o&&("string"==typeof o||"number"==typeof o||"boolean"==typeof o?t[s]=o:t[s]=String(o));return t})({...e.metadata,source:"bugscout"}));await o.add({ids:r,documents:i,metadatas:d})}catch(t){console.error(`[Chroma] addToChroma(${e}) error:`,t)}}var d=s(68420),a=s(27382);let l={async syncMonitoring(e){if(0===e.length)return;let t=e.map(e=>({id:e.recordingId,document:JSON.stringify({recordingId:e.recordingId,distinctId:e.distinctId,recordingDuration:e.recordingDuration,startTime:e.startTime,clickCount:e.clickCount,consoleErrorCount:e.consoleErrorCount,rageClickCount:e.rageClickCount,deadClickCount:e.deadClickCount,startUrl:e.startUrl}),metadata:{recordingId:e.recordingId,table:"monitoring"}}));await n("monitoring",t)},async syncIssues(e){if(0===e.length)return;let t=e.map(e=>({id:e.id??e.recordingId,document:JSON.stringify({recordingId:e.recordingId,title:e.title,description:e.description,severity:e.severity,codeLocation:e.codeLocation,suggestedFix:e.suggestedFix,status:e.status}),metadata:{recordingId:e.recordingId,table:"issues",severity:e.severity,title:e.title}}));await n("issues",t)},async syncLogs(e){if(0===e.length)return;let t=e.map((e,t)=>({id:e.id?`${e.recordingId}-${e.id}`:`${e.recordingId}-${Date.now()}-${t}`,document:JSON.stringify({recordingId:e.recordingId,title:e.title,description:e.description,severity:e.severity,suggestedFix:e.suggestedFix,developerRating:e.developerRating,agentConfidenceScore:e.agentConfidenceScore}),metadata:{recordingId:e.recordingId,table:"logs",severity:e.severity,title:e.title}}));await n("logs",t)},async syncPosthogEvents(e){if(0===e.length)return;let t=e.map(e=>({id:e.posthogEventId,document:JSON.stringify({eventName:e.eventName,url:e.url,elementTag:e.elementTag,elementText:e.elementText,timestamp:e.timestamp,distinctId:e.distinctId}),metadata:{posthogEventId:e.posthogEventId,table:"posthog_events",eventName:e.eventName}}));await n("posthog_events",t)},async syncAll(){let e=await d.db.select().from(a.monitoring);for(let t=0;t<e.length;t+=100)await l.syncMonitoring(e.slice(t,t+100));let t=await d.db.select().from(a.issues);for(let e=0;e<t.length;e+=100)await l.syncIssues(t.slice(e,e+100));let s=await d.db.select().from(a.logs);for(let e=0;e<s.length;e+=100)await l.syncLogs(s.slice(e,e+100));let o=await d.db.select().from(a.posthogEvents);for(let e=0;e<o.length;e+=100)await l.syncPosthogEvents(o.slice(e,e+100));return{monitoring:e.length,issues:t.length,logs:s.length,posthog_events:o.length}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),o=t.X(0,[379,321,266],()=>s(44453));module.exports=o})();
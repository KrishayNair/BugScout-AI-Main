"use strict";(()=>{var e={};e.id=615,e.ids=[615],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},66916:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>_,patchFetch:()=>m,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var o={};i.r(o),i.d(o,{POST:()=>l});var s=i(73278),r=i(45002),n=i(54877),d=i(68420),a=i(27382),u=i(29785);async function l(e,{params:t}){if(!process.env.DATABASE_URL)return Response.json({ok:!1},{status:503});try{let{recordingId:i}=await t,o=await e.json(),s="string"==typeof o.instruction?o.instruction:"",r="string"==typeof o.suggestedFixAfter?o.suggestedFixAfter:null,[n]=await d.db.select().from(a.issues).where((0,u.eq)(a.issues.recordingId,i));if(!n)return Response.json({ok:!1,message:"Issue not found"},{status:404});return await d.db.insert(a.issueRevisions).values({issueId:n.id,instruction:s,suggestedFixAfter:r}),null!=r&&await d.db.update(a.issues).set({suggestedFix:r,updatedAt:new Date}).where((0,u.eq)(a.issues.recordingId,i)),Response.json({ok:!0})}catch(e){return console.error("POST /api/db/issues/[recordingId]/revisions error:",e),Response.json({ok:!1},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/db/issues/[recordingId]/revisions/route",pathname:"/api/db/issues/[recordingId]/revisions",filename:"route",bundlePath:"app/api/db/issues/[recordingId]/revisions/route"},resolvedPagePath:"C:\\Users\\RISHAY\\Downloads\\bugScout Frontend\\app\\api\\db\\issues\\[recordingId]\\revisions\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:f}=c,_="/api/db/issues/[recordingId]/revisions/route";function m(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},68420:(e,t,i)=>{i.d(t,{db:()=>d});var o=i(40546),s=i(92512),r=i(27382);let n=(0,o.qn)(process.env.DATABASE_URL),d=(0,s.tS)(n,{schema:r})},27382:(e,t,i)=>{i.r(t),i.d(t,{issueRevisions:()=>f,issues:()=>g,logs:()=>_,monitoring:()=>p,posthogEvents:()=>m});var o=i(61951),s=i(59397),r=i(39411),n=i(84006),d=i(70380),a=i(83204),u=i(10950),l=i(21305),c=i(67691);let p=(0,o.af)("monitoring",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),recordingId:(0,r.fL)("recording_id").notNull(),distinctId:(0,r.fL)("distinct_id"),recordingDuration:(0,n._L)("recording_duration"),startTime:(0,d.AB)("start_time",{withTimezone:!0}),clickCount:(0,n._L)("click_count"),consoleErrorCount:(0,n._L)("console_error_count"),rageClickCount:(0,n._L)("rage_click_count"),deadClickCount:(0,n._L)("dead_click_count"),startUrl:(0,r.fL)("start_url"),payload:(0,a.JB)("payload"),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()},e=>[(0,u.o9)("monitoring_recording_id_idx").on(e.recordingId)]),g=(0,o.af)("issues",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),recordingId:(0,r.fL)("recording_id").notNull().unique(),posthogCategoryId:(0,r.fL)("posthog_category_id").notNull(),posthogIssueTypeId:(0,r.fL)("posthog_issue_type_id").notNull(),title:(0,r.fL)("title").notNull(),description:(0,r.fL)("description").notNull(),severity:(0,r.fL)("severity").notNull(),codeLocation:(0,r.fL)("code_location").notNull(),codeSnippetHint:(0,r.fL)("code_snippet_hint"),startUrl:(0,r.fL)("start_url"),suggestedFix:(0,r.fL)("suggested_fix"),status:(0,r.fL)("status").notNull().default("Unresolved"),approved:(0,l.O7)("approved").notNull().default(!1),approvedRating:(0,n._L)("approved_rating"),approvedAt:(0,d.AB)("approved_at",{withTimezone:!0}),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),f=(0,o.af)("issue_revisions",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),issueId:(0,s.Vj)("issue_id").notNull().references(()=>g.id,{onDelete:"cascade"}),instruction:(0,r.fL)("instruction").notNull(),suggestedFixAfter:(0,r.fL)("suggested_fix_after"),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),_=(0,o.af)("logs",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),issueId:(0,s.Vj)("issue_id").references(()=>g.id),recordingId:(0,r.fL)("recording_id").notNull(),title:(0,r.fL)("title").notNull(),description:(0,r.fL)("description").notNull(),severity:(0,r.fL)("severity").notNull(),suggestedFix:(0,r.fL)("suggested_fix").notNull(),developerRating:(0,n._L)("developer_rating"),agentConfidenceScore:(0,c.gH)("agent_confidence_score",{precision:3,scale:2}),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),m=(0,o.af)("posthog_events",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),posthogEventId:(0,r.fL)("posthog_event_id").notNull(),eventName:(0,r.fL)("event_name").notNull(),distinctId:(0,r.fL)("distinct_id"),timestamp:(0,d.AB)("timestamp",{withTimezone:!0}).notNull(),url:(0,r.fL)("url"),elementTag:(0,r.fL)("element_tag"),elementText:(0,r.fL)("element_text"),sessionId:(0,r.fL)("session_id"),properties:(0,a.JB)("properties"),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()},e=>[(0,u.o9)("posthog_events_posthog_event_id_idx").on(e.posthogEventId)])}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),o=t.X(0,[379,321],()=>i(66916));module.exports=o})();
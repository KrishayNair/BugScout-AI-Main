(()=>{var e={};e.id=177,e.ids=[177],e.modules={56572:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=56572,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{"use strict";e.exports=require("sharp")},87561:e=>{"use strict";e.exports=require("node:fs")},49411:e=>{"use strict";e.exports=require("node:path")},97742:e=>{"use strict";e.exports=require("node:process")},41041:e=>{"use strict";e.exports=require("node:url")},95263:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>_,requestAsyncStorage:()=>g,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var n={};r.r(n),r.d(n,{GET:()=>c,dynamic:()=>d,maxDuration:()=>l});var o=r(73278),i=r(45002),s=r(54877),a=r(10318);let d="force-dynamic",l=60;async function c(e){let t=process.env.CRON_SECRET;if(t&&e.headers.get("authorization")!==`Bearer ${t}`)return Response.json({ok:!1,message:"Unauthorized"},{status:401});if(!process.env.DATABASE_URL)return Response.json({ok:!1,message:"DATABASE_URL not set"},{status:503});if(!process.env.CHROMA_API_KEY)return Response.json({ok:!1,message:"CHROMA_API_KEY not set"},{status:503});if(!process.env.OPENAI_API_KEY)return Response.json({ok:!1,message:"OPENAI_API_KEY not set. Chroma needs it for embeddings."},{status:503});try{let e=await a.c.syncAll();return Response.json({ok:!0,synced:e})}catch(e){return console.error("cron vector-sync error:",e),Response.json({ok:!1,error:e instanceof Error?e.message:"Sync failed"},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/cron/vector-sync/route",pathname:"/api/cron/vector-sync",filename:"route",bundlePath:"app/api/cron/vector-sync/route"},resolvedPagePath:"C:\\Users\\RISHAY\\Downloads\\bugScout Frontend\\app\\api\\cron\\vector-sync\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:p,serverHooks:m}=u,f="/api/cron/vector-sync/route";function _(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}},68420:(e,t,r)=>{"use strict";r.d(t,{db:()=>a});var n=r(40546),o=r(92512),i=r(27382);let s=(0,n.qn)(process.env.DATABASE_URL),a=(0,o.tS)(s,{schema:i})},27382:(e,t,r)=>{"use strict";r.r(t),r.d(t,{issueRevisions:()=>m,issues:()=>p,logs:()=>f,monitoring:()=>g,posthogEvents:()=>_});var n=r(61951),o=r(59397),i=r(39411),s=r(84006),a=r(70380),d=r(83204),l=r(10950),c=r(21305),u=r(67691);let g=(0,n.af)("monitoring",{id:(0,o.Vj)("id").primaryKey().defaultRandom(),recordingId:(0,i.fL)("recording_id").notNull(),distinctId:(0,i.fL)("distinct_id"),recordingDuration:(0,s._L)("recording_duration"),startTime:(0,a.AB)("start_time",{withTimezone:!0}),clickCount:(0,s._L)("click_count"),consoleErrorCount:(0,s._L)("console_error_count"),rageClickCount:(0,s._L)("rage_click_count"),deadClickCount:(0,s._L)("dead_click_count"),startUrl:(0,i.fL)("start_url"),payload:(0,d.JB)("payload"),createdAt:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()},e=>[(0,l.o9)("monitoring_recording_id_idx").on(e.recordingId)]),p=(0,n.af)("issues",{id:(0,o.Vj)("id").primaryKey().defaultRandom(),recordingId:(0,i.fL)("recording_id").notNull().unique(),posthogCategoryId:(0,i.fL)("posthog_category_id").notNull(),posthogIssueTypeId:(0,i.fL)("posthog_issue_type_id").notNull(),title:(0,i.fL)("title").notNull(),description:(0,i.fL)("description").notNull(),severity:(0,i.fL)("severity").notNull(),codeLocation:(0,i.fL)("code_location").notNull(),codeSnippetHint:(0,i.fL)("code_snippet_hint"),startUrl:(0,i.fL)("start_url"),suggestedFix:(0,i.fL)("suggested_fix"),status:(0,i.fL)("status").notNull().default("Unresolved"),approved:(0,c.O7)("approved").notNull().default(!1),approvedRating:(0,s._L)("approved_rating"),approvedAt:(0,a.AB)("approved_at",{withTimezone:!0}),createdAt:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,a.AB)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),m=(0,n.af)("issue_revisions",{id:(0,o.Vj)("id").primaryKey().defaultRandom(),issueId:(0,o.Vj)("issue_id").notNull().references(()=>p.id,{onDelete:"cascade"}),instruction:(0,i.fL)("instruction").notNull(),suggestedFixAfter:(0,i.fL)("suggested_fix_after"),createdAt:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),f=(0,n.af)("logs",{id:(0,o.Vj)("id").primaryKey().defaultRandom(),issueId:(0,o.Vj)("issue_id").references(()=>p.id),recordingId:(0,i.fL)("recording_id").notNull(),title:(0,i.fL)("title").notNull(),description:(0,i.fL)("description").notNull(),severity:(0,i.fL)("severity").notNull(),suggestedFix:(0,i.fL)("suggested_fix").notNull(),developerRating:(0,s._L)("developer_rating"),agentConfidenceScore:(0,u.gH)("agent_confidence_score",{precision:3,scale:2}),createdAt:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),_=(0,n.af)("posthog_events",{id:(0,o.Vj)("id").primaryKey().defaultRandom(),posthogEventId:(0,i.fL)("posthog_event_id").notNull(),eventName:(0,i.fL)("event_name").notNull(),distinctId:(0,i.fL)("distinct_id"),timestamp:(0,a.AB)("timestamp",{withTimezone:!0}).notNull(),url:(0,i.fL)("url"),elementTag:(0,i.fL)("element_tag"),elementText:(0,i.fL)("element_text"),sessionId:(0,i.fL)("session_id"),properties:(0,d.JB)("properties"),createdAt:(0,a.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()},e=>[(0,l.o9)("posthog_events_posthog_event_id_idx").on(e.posthogEventId)])},10318:(e,t,r)=>{"use strict";r.d(t,{c:()=>l});var n=r(74266);async function o(e){let t=process.env.OPENAI_API_KEY;if(!t)throw Error("OPENAI_API_KEY is required for Chroma embeddings");let r=await fetch("https://api.openai.com/v1/embeddings",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:"text-embedding-3-small",input:e})});if(!r.ok){let e=await r.text();throw Error(`OpenAI embeddings failed: ${r.status} ${e}`)}return(await r.json()).data.map(e=>e.embedding)}let i=null;async function s(e,t){if(0===t.length)return;let r=function(){if(!process.env.CHROMA_API_KEY)return null;if(i)return i;try{return i=new n.NF({apiKey:process.env.CHROMA_API_KEY,tenant:process.env.CHROMA_TENANT??"38d2507b-966b-47d3-b7a5-dd1385383481",database:process.env.CHROMA_DATABASE??"bugScoutAI-main"})}catch{return null}}();if(!r)return;let s=process.env.OPENAI_API_KEY?{async generate(e){if(0===e.length)return[];let t=[];for(let r=0;r<e.length;r+=100){let n=e.slice(r,r+100);t.push(...await o(n))}return t},async generateQueryEmbeddings(e){return this.generate(e)}}:null;if(!s){console.warn("[Chroma] OPENAI_API_KEY not set; skipping sync. Set it in .env.local for Chroma embeddings.");return}try{let n=await r.getOrCreateCollection({name:e,embeddingFunction:s}),o=t.map(e=>e.id),i=t.map(e=>e.document),a=t.map(e=>(function(e){let t={};for(let[r,n]of Object.entries(e))null!=n&&("string"==typeof n||"number"==typeof n||"boolean"==typeof n?t[r]=n:t[r]=String(n));return t})({...e.metadata,source:"bugscout"}));await n.add({ids:o,documents:i,metadatas:a})}catch(t){console.error(`[Chroma] addToChroma(${e}) error:`,t)}}var a=r(68420),d=r(27382);let l={async syncMonitoring(e){if(0===e.length)return;let t=e.map(e=>({id:e.recordingId,document:JSON.stringify({recordingId:e.recordingId,distinctId:e.distinctId,recordingDuration:e.recordingDuration,startTime:e.startTime,clickCount:e.clickCount,consoleErrorCount:e.consoleErrorCount,rageClickCount:e.rageClickCount,deadClickCount:e.deadClickCount,startUrl:e.startUrl}),metadata:{recordingId:e.recordingId,table:"monitoring"}}));await s("monitoring",t)},async syncIssues(e){if(0===e.length)return;let t=e.map(e=>({id:e.id??e.recordingId,document:JSON.stringify({recordingId:e.recordingId,title:e.title,description:e.description,severity:e.severity,codeLocation:e.codeLocation,suggestedFix:e.suggestedFix,status:e.status}),metadata:{recordingId:e.recordingId,table:"issues",severity:e.severity,title:e.title}}));await s("issues",t)},async syncLogs(e){if(0===e.length)return;let t=e.map((e,t)=>({id:e.id?`${e.recordingId}-${e.id}`:`${e.recordingId}-${Date.now()}-${t}`,document:JSON.stringify({recordingId:e.recordingId,title:e.title,description:e.description,severity:e.severity,suggestedFix:e.suggestedFix,developerRating:e.developerRating,agentConfidenceScore:e.agentConfidenceScore}),metadata:{recordingId:e.recordingId,table:"logs",severity:e.severity,title:e.title}}));await s("logs",t)},async syncPosthogEvents(e){if(0===e.length)return;let t=e.map(e=>({id:e.posthogEventId,document:JSON.stringify({eventName:e.eventName,url:e.url,elementTag:e.elementTag,elementText:e.elementText,timestamp:e.timestamp,distinctId:e.distinctId}),metadata:{posthogEventId:e.posthogEventId,table:"posthog_events",eventName:e.eventName}}));await s("posthog_events",t)},async syncAll(){let e=await a.db.select().from(d.monitoring);for(let t=0;t<e.length;t+=100)await l.syncMonitoring(e.slice(t,t+100));let t=await a.db.select().from(d.issues);for(let e=0;e<t.length;e+=100)await l.syncIssues(t.slice(e,e+100));let r=await a.db.select().from(d.logs);for(let e=0;e<r.length;e+=100)await l.syncLogs(r.slice(e,e+100));let n=await a.db.select().from(d.posthogEvents);for(let e=0;e<n.length;e+=100)await l.syncPosthogEvents(n.slice(e,e+100));return{monitoring:e.length,issues:t.length,logs:r.length,posthog_events:n.length}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[379,321,266],()=>r(95263));module.exports=n})();